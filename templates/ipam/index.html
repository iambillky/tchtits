<!--
File: templates/ipam/index.html
Purpose: Main IPAM dashboard with network overview and quick actions
Version: 1.0.0
Author: DCMS Team
Created: 2025-01-14

Revision History:
- v1.0.0 (2025-01-14): Initial creation with network overview, stats, and quick search
                        Manual entry focused interface
                        No import functionality as per requirements
-->

{% extends "base.html" %}

{% block title %}IP Address Management{% endblock %}

{% block extra_css %}
<style>
    /* ========== IPAM SPECIFIC STYLES ========== */
    
    /* ========== QUICK SEARCH BAR ========== */
    .ipam-search-bar {
        background: linear-gradient(135deg, rgba(96, 165, 250, 0.1), rgba(167, 139, 250, 0.05));
        border: 1px solid rgba(96, 165, 250, 0.2);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 30px;
    }
    
    .search-input-group {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    
    .search-input {
        flex: 1;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 8px;
        padding: 12px 16px;
        color: #fff;
        font-size: 1.1rem;
    }
    
    .search-input::placeholder {
        color: #8b92a5;
    }
    
    .search-input:focus {
        outline: none;
        border-color: #60a5fa;
        background: rgba(255, 255, 255, 0.1);
    }
    
    /* ========== STATS GRID ========== */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
    }
    
    .stat-card:hover {
        background: rgba(255, 255, 255, 0.08);
        transform: translateY(-2px);
    }
    
    .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 5px;
    }
    
    .stat-label {
        color: #8b92a5;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .stat-value.total { color: #60a5fa; }
    .stat-value.available { color: #10b981; }
    .stat-value.assigned { color: #f59e0b; }
    .stat-value.quarantine { color: #ef4444; }
    .stat-value.reserved { color: #a78bfa; }
    
    /* ========== NETWORK CARDS ========== */
    .network-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .network-card {
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 20px;
        transition: all 0.3s ease;
    }
    
    .network-card:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(96, 165, 250, 0.3);
    }
    
    .network-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .network-cidr {
        font-size: 1.2rem;
        font-weight: 600;
        color: #60a5fa;
        font-family: 'Courier New', monospace;
    }
    
    .network-badge {
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .badge-bgp {
        background: rgba(52, 211, 153, 0.2);
        color: #34d399;
        border: 1px solid rgba(52, 211, 153, 0.3);
    }
    
    .badge-private {
        background: rgba(167, 139, 250, 0.2);
        color: #a78bfa;
        border: 1px solid rgba(167, 139, 250, 0.3);
    }
    
    .network-stats {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-bottom: 15px;
    }
    
    .network-stat {
        display: flex;
        justify-content: space-between;
        padding: 5px 0;
    }
    
    .network-stat-label {
        color: #8b92a5;
        font-size: 0.85rem;
    }
    
    .network-stat-value {
        color: #e4e6eb;
        font-weight: 600;
    }
    
    .network-utilization {
        margin-top: 10px;
    }
    
    .utilization-bar {
        height: 8px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        overflow: hidden;
        margin-top: 5px;
    }
    
    .utilization-fill {
        height: 100%;
        transition: width 0.3s ease;
    }
    
    .utilization-low { background: #10b981; }
    .utilization-medium { background: #f59e0b; }
    .utilization-high { background: #ef4444; }
    
    .network-actions {
        display: flex;
        gap: 8px;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    /* ========== QUICK ACTIONS ========== */
    .quick-actions {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 30px;
    }
    
    .quick-actions-title {
        color: #fff;
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 15px;
    }
    
    .action-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .action-btn {
        background: linear-gradient(135deg, rgba(96, 165, 250, 0.2), rgba(96, 165, 250, 0.1));
        border: 1px solid rgba(96, 165, 250, 0.3);
        color: #60a5fa;
        padding: 10px 20px;
        border-radius: 8px;
        text-decoration: none;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }
    
    .action-btn:hover {
        background: linear-gradient(135deg, rgba(96, 165, 250, 0.3), rgba(96, 165, 250, 0.2));
        transform: translateY(-2px);
        color: #93c5fd;
    }
    
    .action-btn.primary {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        border-color: #3b82f6;
        color: #fff;
    }
    
    .action-btn.primary:hover {
        background: linear-gradient(135deg, #2563eb, #1d4ed8);
    }
    
    /* ========== VLAN LIST ========== */
    .vlan-list {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 12px;
        padding: 20px;
    }
    
    .vlan-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        margin-bottom: 8px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        transition: all 0.2s ease;
    }
    
    .vlan-item:hover {
        background: rgba(255, 255, 255, 0.08);
    }
    
    .vlan-number {
        font-weight: 600;
        color: #60a5fa;
        margin-right: 10px;
    }
    
    .vlan-ranges {
        flex: 1;
        color: #8b92a5;
        font-size: 0.9rem;
        font-family: 'Courier New', monospace;
    }
    
    .vlan-tag {
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        background: rgba(167, 139, 250, 0.2);
        color: #a78bfa;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">IP Address Management</h1>
    <p class="page-subtitle">Track and manage all IP allocations - No more ping and pray!</p>
</div>

<!-- ========== QUICK IP SEARCH ========== -->
<div class="ipam-search-bar">
    <form id="quickSearchForm" method="GET" action="{{ url_for('ipam.search') }}">
        <div class="search-input-group">
            <span style="color: #60a5fa; font-size: 1.5rem;">üîç</span>
            <input type="text" 
                   name="ip" 
                   class="search-input" 
                   placeholder="Quick IP lookup... (e.g., 208.76.80.5 or 10.10.5.100)"
                   pattern="^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$"
                   title="Enter a valid IP address">
            <button type="submit" class="btn btn-primary">Search IP</button>
            <button type="button" class="btn btn-success" onclick="window.location.href='{{ url_for('ipam.suggest') }}'">
                üéØ Suggest Next IP
            </button>
        </div>
    </form>
</div>

<!-- ========== STATISTICS OVERVIEW ========== -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-value total">{{ total_ips }}</div>
        <div class="stat-label">Total IPs Tracked</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-value available">{{ available_ips }}</div>
        <div class="stat-label">Available IPs</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-value assigned">{{ assigned_ips }}</div>
        <div class="stat-label">Assigned IPs</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-value quarantine">{{ quarantine_ips }}</div>
        <div class="stat-label">In Quarantine</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-value reserved">{{ reserved_ips }}</div>
        <div class="stat-label">Reserved IPs</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-value total">{{ networks|length }}</div>
        <div class="stat-label">Networks</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-value total">{{ vlans|length }}</div>
        <div class="stat-label">VLANs</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-value total">{{ vps_pools|length }}</div>
        <div class="stat-label">VPS Pools</div>
    </div>
</div>

<!-- ========== QUICK ACTIONS ========== -->
<div class="quick-actions">
    <div class="quick-actions-title">Quick Actions</div>
    <div class="action-buttons">
        <a href="{{ url_for('ipam.add_network') }}" class="action-btn primary">
            <span>‚ûï</span> Add Network
        </a>
        <a href="{{ url_for('ipam.add_vlan') }}" class="action-btn">
            <span>üîß</span> Add VLAN
        </a>
        <a href="{{ url_for('ipam.add_range') }}" class="action-btn">
            <span>üìä</span> Add IP Range
        </a>
        <a href="{{ url_for('ipam.vps_pools') }}" class="action-btn">
            <span>üíª</span> Manage VPS Pools
        </a>
        <a href="{{ url_for('ipam.bulk_assign') }}" class="action-btn">
            <span>üì¶</span> Bulk Assign
        </a>
        <a href="{{ url_for('ipam.history') }}" class="action-btn">
            <span>üìú</span> View History
        </a>
        <a href="{{ url_for('ipam.quarantine') }}" class="action-btn">
            <span>‚è∞</span> Quarantine List
        </a>
    </div>
</div>

<!-- ========== NETWORK OVERVIEW ========== -->
<h2 style="color: #fff; margin-bottom: 20px;">Network Overview</h2>

{% if networks %}
<div class="network-grid">
    {% for network in networks %}
    <div class="network-card">
        <div class="network-header">
            <span class="network-cidr">{{ network.network }}</span>
            {% if network.bgp_advertised %}
            <span class="network-badge badge-bgp">BGP</span>
            {% endif %}
            {% if network.network.startswith('10.') %}
            <span class="network-badge badge-private">Private</span>
            {% endif %}
        </div>
        
        <div class="network-stats">
            <div class="network-stat">
                <span class="network-stat-label">Total IPs:</span>
                <span class="network-stat-value">{{ network.total_ips }}</span>
            </div>
            <div class="network-stat">
                <span class="network-stat-label">Ranges:</span>
                <span class="network-stat-value">{{ network.ip_ranges.count() }}</span>
            </div>
            <div class="network-stat">
                <span class="network-stat-label">Available:</span>
                <span class="network-stat-value">{{ network.available_count }}</span>
            </div>
            <div class="network-stat">
                <span class="network-stat-label">Assigned:</span>
                <span class="network-stat-value">{{ network.assigned_count }}</span>
            </div>
        </div>
        
        {% if network.description %}
        <div style="color: #8b92a5; font-size: 0.9rem; margin-bottom: 10px;">
            {{ network.description }}
        </div>
        {% endif %}
        
        <div class="network-utilization">
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <span style="color: #8b92a5; font-size: 0.85rem;">Utilization</span>
                <span style="color: #e4e6eb; font-size: 0.85rem;">{{ network.utilization }}%</span>
            </div>
            <div class="utilization-bar">
                {% set util_percent = network.utilization %}
                <div class="utilization-fill 
                    {% if util_percent < 50 %}utilization-low
                    {% elif util_percent < 80 %}utilization-medium
                    {% else %}utilization-high{% endif %}"
                    style="width: {{ util_percent }}%;">
                </div>
            </div>
        </div>
        
        <div class="network-actions">
            <a href="{{ url_for('ipam.network_detail', network_id=network.id) }}" class="btn btn-sm btn-outline-primary">
                View Details
            </a>
            <a href="{{ url_for('ipam.network_ips', network_id=network.id) }}" class="btn btn-sm btn-outline-secondary">
                Browse IPs
            </a>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<!-- ========== EMPTY STATE ========== -->
<div class="empty-state">
    <div class="empty-state-icon">üåê</div>
    <h3>No Networks Configured</h3>
    <p>Start by adding your first network block to begin tracking IP addresses.</p>
    <a href="{{ url_for('ipam.add_network') }}" class="btn btn-primary mt-3">
        <span style="margin-right: 8px;">‚ûï</span> Add First Network
    </a>
</div>
{% endif %}

<!-- ========== VLAN SUMMARY ========== -->
{% if vlans %}
<h2 style="color: #fff; margin: 30px 0 20px;">VLAN Configuration</h2>
<div class="vlan-list">
    {% for vlan in vlans[:10] %}  <!-- Show first 10 VLANs -->
    <div class="vlan-item">
        <span class="vlan-number">VLAN {{ vlan.vlan_number }}</span>
        <span class="vlan-ranges">
            {% for range in vlan.ip_ranges.limit(2).all() %}
                {{ range.start_ip }}-{{ range.end_ip.split('.')[-1] }}
                {% if not loop.last %}, {% endif %}
            {% endfor %}
            {% if vlan.ip_ranges.count() > 2 %}
                + {{ vlan.ip_ranges.count() - 2 }} more
            {% endif %}
        </span>
        {% if vlan.is_vps %}
        <span class="vlan-tag">VPS</span>
        {% elif vlan.is_colo %}
        <span class="vlan-tag">COLO</span>
        {% elif vlan.is_private %}
        <span class="vlan-tag">PRIVATE</span>
        {% endif %}
        <a href="{{ url_for('ipam.vlan_detail', vlan_id=vlan.id) }}" class="btn btn-sm btn-outline-primary">
            View
        </a>
    </div>
    {% endfor %}
    
    {% if vlans|length > 10 %}
    <div style="text-align: center; margin-top: 15px;">
        <a href="{{ url_for('ipam.vlans') }}" class="btn btn-outline-secondary">
            View All {{ vlans|length }} VLANs
        </a>
    </div>
    {% endif %}
</div>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
// ========== QUICK IP SEARCH VALIDATION ==========
document.getElementById('quickSearchForm').addEventListener('submit', function(e) {
    const ipInput = this.querySelector('input[name="ip"]');
    const ip = ipInput.value.trim();
    
    if (!ip) {
        e.preventDefault();
        alert('Please enter an IP address to search');
        ipInput.focus();
        return false;
    }
    
    // Basic IP validation
    const ipRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
    if (!ipRegex.test(ip)) {
        e.preventDefault();
        alert('Please enter a valid IP address (e.g., 192.168.1.1)');
        ipInput.focus();
        return false;
    }
});

// ========== AUTO-REFRESH STATS ==========
// Refresh stats every 30 seconds to show current state
setInterval(function() {
    // In production, this would make an AJAX call to update stats
    console.log('Stats refresh triggered');
}, 30000);
</script>
{% endblock %}